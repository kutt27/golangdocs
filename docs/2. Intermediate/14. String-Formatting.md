# String Formatting in Go: A Comprehensive Guide

!!! abstract "Overview
    Master Go's string formatting capabilities using the fmt package. Learn formatting verbs, width/precision control, custom formatting, and patterns for creating professional output, reports, and user interfaces.

!!! tip "Key Points"
    - Use fmt.Sprintf for formatted strings, fmt.Printf for direct output
    - Formatting verbs control how values are represented (%s, %d, %f, etc.)
    - Width and precision control spacing and decimal places
    - Custom formatting via Stringer and Formatter interfaces
    - Essential for creating professional reports and user interfaces

## Understanding String Formatting

String formatting is the process of creating formatted strings by combining literal text with formatted values. In Go, the `fmt` package provides powerful formatting capabilities.

!!! info "Formatting Components"
    ```mermaid
    graph LR
        A[String Formatting] --> B[Format Verbs]
        A --> C[Width/Precision]
        A --> D[Flags]
        A --> E[Custom Types]
        B --> F[%s, %d, %f, etc.]
        C --> G[Spacing Control]
        D --> H[+ - 0 #]
        E --> I[Stringer/Formatter]
        style A fill:#999,stroke:#333,stroke-width:2px,color:#000
    ```

## Basic Formatting Functions

### 1. `fmt.Sprintf` - Format to String

!!! example "Basic String Formatting"
    ```go title="sprintf_example.go" linenums="1" hl_lines="8-18"
    package main

    import (
        "fmt"
        "time"
    )

    func main() {
        // Basic formatting
        name := "Alice"
        age := 30
        formatted := fmt.Sprintf("Name: %s, Age: %d", name, age)
        fmt.Println(formatted) // "Name: Alice, Age: 30"
        
        // Multiple values
        item := "Laptop"
        price := 999.99
        inStock := true
        formatted = fmt.Sprintf("Item: %s, Price: $%.2f, In Stock: %t", item, price, inStock)
        fmt.Println(formatted) // "Item: Laptop, Price: $999.99, In Stock: true"
        
        // Date formatting
        now := time.Now()
        formatted = fmt.Sprintf("Current time: %s", now.Format("2006-01-02 15:04:05"))
        fmt.Println(formatted) // "Current time: 2023-11-15 14:30:45"
    }
    ```

### 2. `fmt.Printf` - Format and Print

!!! example "Printf Example"
    ```go title="printf_example.go" linenums="1" hl_lines="8-16"
    package main

    import "fmt"

    func main() {
        // Direct printing
        fmt.Printf("Hello, %s!\n", "World") // "Hello, World!"
        
        // Multiple arguments
        fmt.Printf("%s has %d apples\n", "Bob", 5) // "Bob has 5 apples"
        
        // Without newline
        fmt.Printf("Processing...") // No newline
        fmt.Printf("Done!\n")      // "Processing...Done!"
    }
    ```

### 3. `fmt.Fprintf` - Format to Writer

!!! example "Fprintf Example"
    ```go title="fprintf_example.go" linenums="1" hl_lines="8-22"
    package main

    import (
        "bytes"
        "fmt"
        "os"
        "time"
    )

    func main() {
        // Write to buffer
        var buf bytes.Buffer
        fmt.Fprintf(&buf, "Error: %s occurred at %v", "timeout", time.Now())
        fmt.Println(buf.String())
        
        // Write to file
        file, err := os.Create("log.txt")
        if err != nil {
            panic(err)
        }
        defer file.Close()
        
        fmt.Fprintf(file, "Log entry: %s\n", time.Now().Format(time.RFC3339))
    }
    ```

## Formatting Verbs Reference

### General Verbs

!!! example "General Verbs"
    ```go title="general_verbs.go" linenums="1" hl_lines="8-18"
    package main

    import "fmt"

    type Person struct {
        Name string
        Age  int
    }

    func main() {
        p := Person{Name: "Alice", Age: 30}
        
        // %v - Default format
        fmt.Printf("%v\n", p) // {Alice 30}
        
        // %+v - Adds struct field names
        fmt.Printf("%+v\n", p) // {Name:Alice Age:30}
        
        // %#v - Go syntax representation
        fmt.Printf("%#v\n", []int{1, 2}) // []int{1, 2}
        
        // %T - Type of value
        fmt.Printf("%T\n", 42) // int
        
        // %% - Literal percent sign
        fmt.Printf("%%\n") // %
    }
    ```

### Integer Verbs

!!! example "Integer Verbs"
    ```go title="integer_verbs.go" linenums="1" hl_lines="8-20"
    package main

    import "fmt"

    func main() {
        // %b - Binary
        fmt.Printf("%b\n", 5) // 101
        
        // %c - Character
        fmt.Printf("%c\n", 65) // A
        
        // %d - Decimal
        fmt.Printf("%d\n", 42) // 42
        
        // %o - Octal
        fmt.Printf("%o\n", 8) // 10
        
        // %O - Octal with 0o prefix
        fmt.Printf("%O\n", 8) // 0o10
        
        // %x - Hexadecimal (lowercase)
        fmt.Printf("%x\n", 255) // ff
        
        // %X - Hexadecimal (uppercase)
        fmt.Printf("%X\n", 255) // FF
        
        // %U - Unicode format
        fmt.Printf("%U\n", 'A') // U+0041
    }
    ```

### Floating-Point Verbs

!!! example "Floating-Point Verbs"
    ```go title="float_verbs.go" linenums="1" hl_lines="8-16"
    package main

    import "fmt"

    func main() {
        pi := 3.14159
        
        // %f - Decimal notation
        fmt.Printf("%f\n", pi) // 3.141590
        
        // %.2f - Precision control
        fmt.Printf("%.2f\n", pi) // 3.14
        
        // %e - Scientific notation (lowercase)
        fmt.Printf("%e\n", pi) // 3.141590e+00
        
        // %E - Scientific notation (uppercase)
        fmt.Printf("%E\n", pi) // 3.141590E+00
        
        // %g - Compact notation
        fmt.Printf("%g\n", pi) // 3.14159
    }
    ```

## Width, Precision, and Flags

### 1. Width Specification

!!! example "Width Specification"
    ```go title="width_specification.go" linenums="1" hl_lines="8-16"
    package main

    import "fmt"

    func main() {
        // Integer width
        fmt.Printf("|%5d|\n", 42)      // "|   42|"
        fmt.Printf("|%-5d|\n", 42)     // "|42   |"
        
        // String width
        fmt.Printf("|%10s|\n", "hi")   // "|        hi|"
        fmt.Printf("|%-10s|\n", "hi")  // "|hi        |"
    }
    ```

### 2. Precision Specification

!!! example "Precision Specification"
    ```go title="precision_specification.go" linenums="1" hl_lines="8-16"
    package main

    import "fmt"

    func main() {
        // Float precision
        fmt.Printf("|%.2f|\n", 3.14159) // "|3.14|"
        fmt.Printf("|%.4f|\n", 3.14159) // "|3.1416|"
        
        // String precision
        fmt.Printf("|%.3s|\n", "hello") // "|hel|"
        fmt.Printf("|%.10s|\n", "hi")  // "|hi        |" (padded to width 10)
    }
    ```

### 3. Combined Width and Precision

!!! example "Combined Width and Precision"
    ```go title="combined_width_precision.go" linenums="1" hl_lines="8-16"
    package main

    import "fmt"

    func main() {
        // Float with width and precision
        fmt.Printf("|%10.2f|\n", 3.14159) // "|      3.14|"
        fmt.Printf("|%-10.2f|\n", 3.14159) // "|3.14      |"
        
        // String with width and precision
        fmt.Printf("|%10.3s|\n", "hello") // "|       hel|"
        fmt.Printf("|%-10.3s|\n", "hello") // "|hel       |"
    }
    ```

### 4. Formatting Flags

!!! example "Formatting Flags"
    ```go title="formatting_flags.go" linens="1" hl_lines="8-18"
    package main

    import "fmt"

    func main() {
        // Sign flag
        fmt.Printf("With sign: %+d\n", 42)     // "+42"
        fmt.Printf("With sign: %+d\n", -42)    // "-42"
        
        // Space flag
        fmt.Printf("Space: % d\n", 42)         // " 42"
        fmt.Printf("Space: % d\n", -42)        // "-42"
        
        // Zero padding
        fmt.Printf("Zero pad: %05d\n", 42)     // "00042"
        
        // Alternate format
        fmt.Printf("Alternate: %#o\n", 8)      // "010"
        fmt.Printf("Alternate: %#x\n", 255)    // "0xff"
    }
    ```

## Custom Formatting

### 1. Implementing `Stringer` Interface

!!! example "Stringer Interface"
    ```go title="stringer_interface.go" linums="1" hl_lines="8-20"
    package main

    import "fmt"

    type Person struct {
        Name string
        Age  int
    }

    func (p Person) String() string {
        return fmt.Sprintf("%s (%d years)", p.Name, p.Age)
    }

    func main() {
        p := Person{"Alice", 30}
        fmt.Println(p) // Automatically calls String() method
        fmt.Printf("%v\n", p) // Also uses String()
    }
    ```

### 2. Implementing `Formatter` Interface

!!! example "Formatter Interface"
    ```go title="formatter_interface.go" linums="1" hl_lines="8-27"
    package main

    import "fmt"

    type Money float64

    func (m Money) Format(f fmt.State, verb rune) {
        switch verb {
        case 'f':
            fmt.Fprintf(f, "$%.2f", float64(m))
        case 'F':
            fmt.Fprintf(f, "$%.2f", float64(m))
        case 'v':
            if f.Flag('+') {
                fmt.Fprintf(f, "Money(%v)", float64(m))
            } else {
                fmt.Fprintf(f, "$%.2f", float64(m))
            }
        default:
            fmt.Fprintf(f, "%v", float64(m))
        }
    }

    func main() {
        price := Money(19.99)
        fmt.Printf("Price: %f\n", price)  // "$19.99"
        fmt.Printf("Price: %+v\n", price) // "Money(19.99)"
    }
    ```

## Common Formatting Patterns

### 1. Table Formatting

!!! example "Table Formatting"
    ```go title="table_formatting.go" linums="1" hl_lines="8-20"
    package main

    import "fmt"
    import "strings"

    func main() {
        // Header
        fmt.Printf("%-15s %10s %10s\n", "Name", "Age", "Score")
        fmt.Println(strings.Repeat("-", 35))
        
        // Data rows
        fmt.Printf("%-15s %10d %10.1f\n", "Alice", 30, 95.5)
        fmt.Printf("%-15s %10d %10.1f\n", "Bob", 25, 87.2)
        fmt.Printf("%-15s %10d %10.1f\n", "Charlie", 35, 92.8)
    }
    ```

    Output:
    ```
    Name            Age       Score
    -----------------------------------
    Alice            30       95.5
    Bob              25       87.2
    Charlie          35       92.8
    ```

### 2. Number Formatting

!!! example "Number Formatting"
    ```go title="number_formatting.go" linums="1" hl_lines="8-20"
    package main

    import "fmt"

    func formatNumber(n int) string {
        s := fmt.Sprintf("%d", n)
        
        // Add commas every 3 digits from the right
        for i := len(s) - 3; i > 0; i -= 3 {
            s = s[:i] + "," + s[i:]
        }
        
        return s
    }

    func main() {
        fmt.Println(formatNumber(1000))      // "1,000"
        fmt.Println(formatNumber(1234567))   // "1,234,567"
        fmt.Println(formatNumber(987654321)) // "987,654,321"
    }
    ```

### 3. Progress Bars

!!! example "Progress Bar"
    ```go title="progress_bar.go" linums="1" hl_lines="8-25"
    package main

    import (
        "fmt"
        "strings"
        "time"
    )

    func printProgress(current, total int) {
        percent := float64(current) / float64(total) * 100
        barWidth := 50
        filled := int(percent / 100 * float64(barWidth))
        
        bar := strings.Repeat("=", filled) + strings.Repeat(" ", barWidth-filled)
        fmt.Printf("\r[%s] %.1f%% (%d/%d)", bar, percent, current, total)
    }

    func main() {
        total := 100
        for i := 0; i <= total; i++ {
            printProgress(i, total)
            time.Sleep(50 * time.Millisecond)
        }
        fmt.Println() // Newline after progress completes
    }
    ```

### 4. Logging with Context

!!! example "Structured Logging"
    ```go title="structured_logging.go" linums="1" hl_lines="8-25"
    package main

    import (
        "fmt"
        "time"
    )

    type Logger struct {
        prefix string
    }

    func NewLogger(prefix string) *Logger {
        return &Logger{prefix: prefix}
    }

    func (l *Logger) Log(format string, args ...interface{}) {
        timestamp := time.Now().Format("2006-01-02 15:04:05")
        message := fmt.Sprintf(format, args...)
        fmt.Printf("[%s] %s: %s\n", timestamp, l.prefix, message)
    }

    func main() {
        logger := NewLogger("APP")
        logger.Log("Starting application")
        logger.Log("Processing %d items", 42)
        logger.Log("Error: %s", "connection timeout")
    }
    ```

## Real-World Example: Report Generator

Let's build a comprehensive report generator that demonstrates various formatting techniques:

!!! example "Report Generator"
    ```go title="report_generator.go" linums="1" hl_lines="8-60"
    package main

    import (
        "fmt"
        "io"
        "os"
        "sort"
        "strings"
        "time"
    )

    // ReportData represents the data for our report
    type ReportData struct {
        Title       string
        GeneratedAt time.Time
        Summary     SummaryStats
        Sections    []ReportSection
    }

    type SummaryStats struct {
        TotalRecords int
        SuccessCount int
        ErrorCount   int
        AverageValue float64
    }

    type ReportSection struct {
        Title   string
        Entries []ReportEntry
    }

    type ReportEntry struct {
        ID       string
        Name     string
        Value    float64
        Status   string
        Category string
    }

    // ReportGenerator handles report generation
    type ReportGenerator struct {
        output io.Writer
    }

    func NewReportGenerator(w io.Writer) *ReportGenerator {
        return &ReportGenerator{output: w}
    }

    func (rg *ReportGenerator) GenerateReport(data ReportData) error {
        rg.generateHeader(data)
        rg.generateSummary(data.Summary)
        rg.generateSections(data.Sections)
        rg.generateFooter()
        return nil
    }

    func (rg *ReportGenerator) generateHeader(data ReportData) {
        // Title with underline
        rg.writeln(data.Title)
        rg.writeln(strings.Repeat("=", len(data.Title)))
        rg.writeln("")
        
        // Metadata
        rg.writeln(fmt.Sprintf("Generated: %s", data.GeneratedAt.Format("2006-01-02 15:04:05")))
        rg.writeln("")
    }

    func (rg *ReportGenerator) generateSummary(summary SummaryStats) {
        rg.writeln("Summary")
        rg.writeln(strings.Repeat("-", 7))
        rg.writeln("")
        
        // Summary statistics
        rg.writeln(fmt.Sprintf("Total Records: %s", rg.formatNumber(summary.TotalRecords)))
        rg.writeln(fmt.Sprintf("Successful: %s (%.1f%%)", 
            rg.formatNumber(summary.SuccessCount), 
            float64(summary.SuccessCount)/float64(summary.TotalRecords)*100))
        rg.writeln(fmt.Sprintf("Errors: %s (%.1f%%)", 
            rg.formatNumber(summary.ErrorCount), 
            float64(summary.ErrorCount)/float64(summary.TotalRecords)*100))
        rg.writeln(fmt.Sprintf("Average Value: %s", rg.formatCurrency(summary.AverageValue)))
        rg.writeln("")
    }

    func (rg *ReportGenerator) generateSections(sections []ReportSection) {
        for _, section := range sections {
            rg.generateSection(section)
        }
    }

    func (rg *ReportGenerator) generateSection(section ReportSection) {
        // Section title
        rg.writeln(section.Title)
        rg.writeln(strings.Repeat("-", len(section.Title)))
        rg.writeln("")
        
        // Table header
        rg.writeln(fmt.Sprintf("%-10s %-20s %15s %-10s %s", 
            "ID", "Name", "Value", "Status", "Category"))
        rg.writeln(strings.Repeat("-", 70))
        
        // Sort entries by value (descending)
        entries := make([]ReportEntry, len(section.Entries))
        copy(entries, section.Entries)
        sort.Slice(entries, func(i, j int) bool {
            return entries[i].Value > entries[j].Value
        })
        
        // Table rows
        for _, entry := range entries {
            statusColor := ""
            if entry.Status == "Success" {
                statusColor = "\033[32m" // Green
            } else if entry.Status == "Error" {
                statusColor = "\033[31m" // Red
            }
            resetColor := "\033[0m"
            
            rg.writeln(fmt.Sprintf("%-10s %-20s %15s %s%-10s%s %s", 
                entry.ID,
                entry.Name,
                rg.formatCurrency(entry.Value),
                statusColor,
                entry.Status,
                resetColor,
                entry.Category))
        }
        
        rg.writeln("")
    }

    func (rg *ReportGenerator) generateFooter() {
        rg.writeln(strings.Repeat("=", 50))
        rg.writeln("End of Report")
    }

    func (rg *ReportGenerator) write(s string) {
        fmt.Fprint(rg.output, s)
    }

    func (rg *ReportGenerator) writeln(s string) {
        fmt.Fprintln(rg.output, s)
    }

    func (rg *ReportGenerator) formatNumber(n int) string {
        s := fmt.Sprintf("%d", n)
        for i := len(s) - 3; i > 0; i -= 3 {
            s = s[:i] + "," + s[i:]
        }
        return s
    }

    func (rg *ReportGenerator) formatCurrency(amount float64) string {
        return fmt.Sprintf("$%s%.2f", rg.formatNumber(int(amount)), amount-float64(int(amount)))
    }

    func main() {
        // Sample data
        data := ReportData{
            Title:       "Quarterly Sales Report",
            GeneratedAt: time.Now(),
            Summary: SummaryStats{
                TotalRecords: 1250,
                SuccessCount: 1187,
                ErrorCount:   63,
                AverageValue: 2475.50,
            },
            Sections: []ReportSection{
                {
                    Title: "Top Performers",
                    Entries: []ReportEntry{
                        {"001", "Product A", 5000.00, "Success", "Electronics"},
                        {"002", "Product B", 4500.00, "Success", "Electronics"},
                        {"003", "Product C", 3200.00, "Success", "Clothing"},
                    },
                },
            },
        }
        
        // Generate report to stdout
        generator := NewReportGenerator(os.Stdout)
        if err := generator.GenerateReport(data); err != nil {
            fmt.Printf("Error generating report: %v\n", err)
            os.Exit(1)
        }
    }
    ```

### How This Example Demonstrates String Formatting:

1. **Structured Output**:
   - Uses `fmt.Sprintf` for building formatted strings
   - Implements consistent formatting patterns
   - Creates aligned tables with precise spacing

2. **Custom Formatting Functions**:
   - `formatNumber` adds commas to large numbers
   - `formatCurrency` properly formats monetary values
   - Color codes status indicators

3. **Layout Control**:
   - Uses width specifications for column alignment
   - Implements headers and footers with consistent styling
   - Creates visual separators with repeated characters

## Best Practices

!!! tip "Function Selection"
    Choose the right formatting function for each use case to ensure readability and performance.

!!! example "Function Selection"
    ```go title="function_selection.go" linums="1" hl_lines="8-14"
    package main

    import "fmt"

    func main() {
        // Use fmt.Sprintf when you need a string
        message := fmt.Sprintf("Error: %s", "timeout")
        
        // Use fmt.Printf for direct output
        fmt.Printf("Status: %s\n", "OK")
        
        // Use fmt.Fprintf for writing to files
        // fmt.Fprintf(file, "Log: %s\n", message)
    }
    ```

!!! warning "Performance Considerations"
    Avoid excessive string formatting in performance-critical code.

!!! example "Performance Optimization"
    ```go title="performance_optimization.go" linums="1" hl_lines="8-18"
    package main

    import (
        "fmt"
        "strings"
    )

    func main() {
        // Bad - creates many temporary strings
        var result string
        for i := 0; i < 1000; i++ {
            result += fmt.Sprintf("Item %d", i)
        }
        
        // Good - efficient with Builder
        var builder strings.Builder
        for i := 0; i < 1000; i++ {
            fmt.Fprintf(&builder, "Item %d", i)
        }
        result = builder.String()
    }
    ```

## Quick Reference

!!! success "Key Takeaways"
    - **Basic Functions**: Use `fmt.Sprintf` for strings, `fmt.Printf` for output
    - **Formatting Verbs**: `%s` (string), `%d` (integer), `%f` (float), `%v` (default)
    - **Width/Precision**: Control spacing with `%5d`, decimal places with `%.2f`
    - **Flags**: Use `+` for signs, `-` for left-align, `0` for zero-padding
    - **Custom Formatting**: Implement `Stringer` and `Formatter` interfaces
    - **Common Patterns**: Tables, progress bars, logging with consistent formatting
    - **Performance**: Use `strings.Builder` for complex string building

!!! quote "Remember"
    "String formatting in Go is both powerful and flexible. By mastering formatting verbs, width/precision control, and custom interfaces, you can create professional, readable output for any application. Always choose the right formatting function for your needs and be mindful of performance in critical code paths."